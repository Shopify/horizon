{% assign current_product = closest.product | default: product %}
{% assign family_products = current_product.metafields.custom.variant_family %}

{% if family_products != blank %}
  <div class="variant-family" role="group" aria-label="Choose model">
    {% for product_ref in family_products %}
      {% if product_ref %}
        <a href="{{ product_ref.url }}" 
           class="variant-family__item {% if product_ref.id == current_product.id %}active{% endif %}" 
           aria-current="{% if product_ref.id == current_product.id %}true{% else %}false{% endif %}" 
           title="{{ product_ref.title | default: 'Sibling product' }}">
          
          {% comment %}
          Shopify does not expose featured_image on GID references.
          Use placeholder or swatch.
          {% endcomment %}
          <span class="variant-swatch" aria-label="{{ product_ref.title | default: 'Sibling product' }}"></span>
        </a>
      {% endif %}
    {% endfor %}
  </div>

  <style>
    .variant-family {
      display: flex;
      gap: 10px;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .variant-family__item {
      display: block;
      border: 2px solid transparent;
      border-radius: 8px;
      padding: 2px;
      transition: border-color 0.2s;
      width: 50px;
      height: 50px;
    }

    .variant-family__item.active {
      border-color: #000;
    }

    .variant-swatch {
      display: block;
      width: 100%;
      height: 100%;
      border-radius: 4px;
      background-color: #ccc;
    }

    .variant-family__item:focus {
      outline: 2px solid #000;
      outline-offset: 2px;
    }

    .variant-family__item:hover {
      border-color: #555;
    }
  </style>
{% endif %}
