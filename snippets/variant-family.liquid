{% comment %}
  Variant Family snippet for Horizon 3.0.1
  Displays a horizontal row of sibling products
  Highlights the current product
  Includes heading "Valitse malli"
  Styled similarly to AARNI product page
{% endcomment %}

{% assign current_product = closest.product | default: product %}
{% assign family_products = current_product.metafields.custom.variant_family.value %}

{% if family_products != blank %}
  <div class="variant-family-wrapper">
    <h3 class="variant-family-heading">Valitse malli:</h3>

    <div class="variant-family" role="group" aria-label="Choose model">
      {% assign current_first = family_products | where: "id", current_product.id | first %}
      <a href="{{ current_first.url }}"
         class="variant-family__item active"
         aria-current="true"
         title="{{ current_first.title }}">
        {% if current_first.featured_image %}
          <img src="{{ current_first.featured_image | img_url: '100x100' }}"
               alt="{{ current_first.title }}"
               width="50" height="50">
        {% else %}
          <span class="variant-swatch" aria-label="{{ current_first.title }}"></span>
        {% endif %}
      </a>

      {% for family_product in family_products %}
        {% unless family_product.id == current_product.id %}
          <a href="{{ family_product.url }}"
             class="variant-family__item"
             aria-current="false"
             title="{{ family_product.title }}">
            {% if family_product.featured_image %}
              <img src="{{ family_product.featured_image | img_url: '100x100' }}"
                   alt="{{ family_product.title }}"
                   width="50" height="50">
            {% else %}
              <span class="variant-swatch" aria-label="{{ family_product.title }}"></span>
            {% endif %}
          </a>
        {% endunless %}
      {% endfor %}

    </div>
  </div>

  <style>
    .variant-family-wrapper {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin: 0;
      padding: 0;
    }

    .variant-family-heading {
      font-size: 0.875rem; /* approx 14px */
      font-weight: 500;
      line-height: 1.4;
      color: #6b6b6b; /* a medium-grey tone */
      margin: 0 0 6px 0; /* small gap below heading */
      padding: 0;
      text-transform: uppercase; /* like subtle uppercase styling */
      letter-spacing: 0.05em;
    }

    .variant-family {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-start;
      align-items: center;
      margin: 0;
      padding: 0;
    }

    .variant-family__item {
      display: block;
      width: 50px;
      height: 50px;
      border: 2px solid transparent;
      border-radius: 8px;
      overflow: hidden;
      transition: all 0.2s ease;
      flex-shrink: 0;
      background-color: #f7f7f7;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .variant-family__item.active {
      border-color: #111;
      box-shadow: 0 0 0 2px #111 inset, 0 4px 8px rgba(0,0,0,0.2);
    }

    .variant-family__item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .variant-swatch {
      display: block;
      width: 100%;
      height: 100%;
      border-radius: 4px;
      background-color: #ccc;
    }

    .variant-family__item:hover,
    .variant-family__item:focus {
      border-color: #555;
      outline: none;
      box-shadow: 0 0 0 2px #555 inset, 0 4px 8px rgba(0,0,0,0.15);
    }

    .variant-family__item:focus-visible {
      outline: 2px solid #000;
      outline-offset: 2px;
    }

    @media screen and (max-width: 400px) {
      .variant-family {
        gap: 4px;
      }
      .variant-family__item {
        width: 40px;
        height: 40px;
      }
    }
  </style>

{% endif %}
