{%- comment -%}
variant-family.liquid
Renders a horizontal list of related products coming from product.metafields.custom.variant_family (product list).
Requires the section wrapper to be added to Product template or rendered via include.
Accessibility:
 - active product marked with aria-current
 - focus styles via CSS class .vf-item:focus-visible
 - img alt uses product title
Fallbacks:
 - if metafield missing / empty -> nothing is rendered
 - if related product has no image -> renders a small colored swatch fallback
{%- endcomment -%}

{%- assign related_products = product.metafields.custom.variant_family.value -%}
{%- if related_products and related_products.size > 0 -%}
  <nav class="variant-family" aria-label="Saman perheen tuotteet">
    <ul class="vf-list" role="list">
      {%- for related in related_products -%}
        {%- comment -%} related is a product object from the product_reference list {%- endcomment -%}
        {%- assign is_current = false -%}
        {%- if related.id == product.id -%}
          {%- assign is_current = true -%}
        {%- endif -%}
        <li class="vf-item-wrapper">
          <a href="{{ related.url }}" class="vf-item {% if is_current %}vf-active{% endif %}"
             aria-current="{% if is_current %}true{% endif %}"
             title="{{ related.title }}">
            {%- if related.featured_image -%}
              <img src="{{ related.featured_image | img_url: '80x80' }}" alt="{{ related.title }}" width="80" height="80" loading="lazy" />
            {%- else -%}
              <span class="vf-swatch" aria-hidden="true"></span>
            {%- endif -%}
            <span class="vf-visually-hidden">{{ related.title }}</span>
          </a>
        </li>
      {%- endfor -%}
    </ul>
  </nav>
{%- endif -%}
